# pythonCherkizovo

Тестовое задание: [ТЗ](/docs/ТЗ.docx)

Стек: Python 3.10, pyodbc, Docker, MS SQL 2017, Excel.

## Развертывание

### Переменные среды
Для запуска и тестирования проекта требуется создать файл `.env` с переменными окружения.    
Пример файла: [`.env.example`](.env.example)

#### Параметры подключения к ms sql:
`MSSQL_SERVER` - ip адрес / имя хоста (например, 127.0.0.1 для локальной установки)   
`MSSQL_PORT` - порт (порт по-умолчанию 1433)  
`MSSQL_SA_PASSWORD` - пароль пользователя sa (нужен для создания объектов)  
`MSSQL_DATABASE`- имя базы (например, TestDB)  
`MSSQL_USERNAME`- пользователь базы (например, db_user)  
`MSSQL_PASSWORD`- пароль пользователя (например, Q1q)    

### Скрипт создания объектов
Файл скрипта [db-create.sql](db-create.sql)

Необходимо внести изменения в первые 3 строчки: требуется указать те же данные, 
что и в `.env` файле.  
```
:setvar db_name <MSSQL_DATABASE>
:setvar user_uid <MSSQL_USERNAME>
:setvar user_pwd <MSSQL_PASSWORD>
```
Например,
```
:setvar db_name TestDB
:setvar user_uid db_user
:setvar user_pwd Q1q
```


### При установленном Docker.
Запускаем
```shell
docker compose up -d
```
Создается 2 контейнера:
- mssql - собственно БД;
- mssql_conf - контейнер для конфигурирования mssql (создание пользователя, таблицы, sp).

### При отсутствии Docker.
Необходимо создать в БД требуемые объекты вручную.   
Ссылка на файл скрипта [db-create.sql](db-create.sql)  

## Запуск приложения:
Требования к версии python не выставлялись, поэтому предполагается, что используется версия 3.10 
```sh
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python3 src/main.py
deactivate
```

Файл для загрузки `data.xlsb` находится в `./import`

## Ограничения:
 - MS SQL поднимается в докере, без указаний кодировок и прочая, т.е. с кириллицей может работать не корректно. 
Но в текущем задании у нас кириллицы нет (кроме строки 160444 с артикулом "#ошибка", в отчете эта строка фигурирует как "#??????")
 - Для создания таблицы / процедуры развертывается отдельный контейнер, он находится в нормально выключенном состоянии.  
 - Загрузка идет пакетами по 100 записей. Полагаю правильнее было бы грузить 
данные bulk-ом.
 - Данные загружаются непосредственно в таблицу, правильнее было бы конечно закидывать их
в какую-то временную таблицу, а после переносить в основную.
